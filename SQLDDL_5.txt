
    WITH duplicates AS (
    SELECT NOM_PAIS_ORIG, NOM_PAIS_DEST, CLAVE_SUC_AGE_MVTO, MTCN, FECHA_TRANSC, MTO_ENVIO,
    MTO_ENVIO_USD, COMISION, NOM_AGEN_MVTO, NOM_SUBS_MTVO, TOTAL_IMPTO_MXP, MTO_RED, 
    FOLIO_AFECT, TC_TESO_PVP_PD, TIPO_CAMB,FNIMPMOV_CAJA,
    ROW_NUMBER() OVER (PARTITION BY MTCN ORDER BY FECHA_TRANSC) AS row_num
    FROM usrcon.CONCIL_ALNCAJA_OPEDEX CON
    INNER JOIN usrcon.TRANSACIONES_TIPO_CAMBIO TC
    ON CON.TC_TESO_PVP_PD = TC.destino_valorPago
    WHERE NOM_PAIS_ORIG = 'MEXICO'
    AND  NOM_PAIS_DEST IN ('GUATEMALA','HONDURAS','PANAMA')
    )
    
    
    SELECT NOM_PAIS_ORIG, NOM_PAIS_DEST, CLAVE_SUC_AGE_MVTO, MTCN, FECHA_TRANSC, MTO_ENVIO,
    MTO_ENVIO_USD, COMISION, NOM_AGEN_MVTO, NOM_SUBS_MTVO, TOTAL_IMPTO_MXP, MTO_RED, 
    FOLIO_AFECT, TC_TESO_PVP_PD, TIPO_CAMB, FNIMPMOV_CAJA
  	FROM duplicates
 	WHERE row_num = 1
 	
 	
 	SELECT * FROM usrcon.CONCIL_ALNCAJA_OPEDEX;
 	
 
 
   INNER JOIN usrcon.TRANSACIONES_TIPO_CAMBIO TC
   ON DEX.TC_TESO_PVP_PD = TC.destino_valorPago
 
 
 
 
  WITH duplicates AS (
    SELECT NOM_PAIS_ORIG, NOM_PAIS_DEST, CLAVE_SUC_AGE_MVTO, MTCN, FECHA_TRANSC, MTO_ENVIO,
    MTO_ENVIO_USD, COMISION, NOM_AGEN_MVTO, NOM_SUBS_MTVO, TOTAL_IMPTO_MXP, MTO_RED, 
    FOLIO_AFECT, TC_TESO_PVP_PD, TIPO_CAMB,FNIMPMOV_CAJA, 
      ROW_NUMBER() OVER (PARTITION BY T071_OBSERVATIONS_ALN, FITRANNO_CAJA ORDER BY FCREFMOV_CAJA) AS row_num
    FROM usrcon.TC_ALNCAJA_CONCIL CON
    INNER JOIN usrcon.OP_DEX_TIPO_CAMBIO DEX
    ON CON.FCREFMOV_CAJA = DEX.MTCN
  )
    
  SELECT NOM_PAIS_ORIG, NOM_PAIS_DEST, CLAVE_SUC_AGE_MVTO, MTCN, FECHA_TRANSC, MTO_ENVIO,
    MTO_ENVIO_USD, COMISION, NOM_AGEN_MVTO, NOM_SUBS_MTVO, TOTAL_IMPTO_MXP, MTO_RED, 
    FOLIO_AFECT, TC_TESO_PVP_PD, TIPO_CAMB, FNIMPMOV_CAJA
  FROM duplicates
  WHERE row_num = 1
  
  
  SELECT * FROM usrcon.TRANSACIONES_TIPO_CAMBIO;
  
 
 
 TRUNCATE TABLE usrcon.CONCIL_ALNCAJA_OPEDEX;

SELECT * FROM usrcon.CONCIL_ALNCAJA_OPEDEX;
 
 
 WITH duplicates AS (
    SELECT NOM_PAIS_ORIG, NOM_PAIS_DEST, CLAVE_SUC_AGE_MVTO, MTCN, FECHA_TRANSC, MTO_ENVIO,
    MTO_ENVIO_USD, COMISION, NOM_AGEN_MVTO, NOM_SUBS_MTVO, TOTAL_IMPTO_MXP, MTO_RED, 
    FOLIO_AFECT, TC_TESO_PVP_PD, TIPO_CAMB,FNIMPMOV_CAJA, 
      ROW_NUMBER() OVER (PARTITION BY T071_OBSERVATIONS_ALN, FITRANNO_CAJA ORDER BY FCREFMOV_CAJA) AS row_num
    FROM usrcon.TC_ALNCAJA_CONCIL CON
    INNER JOIN usrcon.OP_DEX_TIPO_CAMBIO DEX
    ON CON.FCREFMOV_CAJA = DEX.MTCN
)
INSERT INTO usrcon.CONCIL_ALNCAJA_OPEDEX (NOM_PAIS_ORIG, NOM_PAIS_DEST, CLAVE_SUC_AGE_MVTO, MTCN, FECHA_TRANSC, MTO_ENVIO,
    MTO_ENVIO_USD, COMISION, NOM_AGEN_MVTO, NOM_SUBS_MTVO, TOTAL_IMPTO_MXP, MTO_RED, 
    FOLIO_AFECT, TC_TESO_PVP_PD, TIPO_CAMB,FNIMPMOV_CAJA)
SELECT NOM_PAIS_ORIG, NOM_PAIS_DEST, CLAVE_SUC_AGE_MVTO, MTCN, FECHA_TRANSC, MTO_ENVIO,
    MTO_ENVIO_USD, COMISION, NOM_AGEN_MVTO, NOM_SUBS_MTVO, TOTAL_IMPTO_MXP, MTO_RED, 
    FOLIO_AFECT, TC_TESO_PVP_PD, TIPO_CAMB, FNIMPMOV_CAJA
FROM duplicates
WHERE NOT EXISTS (
    SELECT 1
    FROM usrcon.CONCIL_ALNCAJA_OPEDEX
    WHERE TC_TESO_PVP_PD = duplicates.TC_TESO_PVP_PD
);






DECLARE @CERO = 0
  WITH duplicates AS (
    SELECT NOM_PAIS_ORIG, 
    NOM_PAIS_DEST, 
    CLAVE_SUC_AGE_MVTO,
    MTCN, 
    FECHA_TRANSC, 
    MTO_ENVIO,
    MTO_ENVIO_USD, 
    COMISION, 
    NOM_AGEN_MVTO, 
    NOM_SUBS_MTVO, 
    TOTAL_IMPTO_MXP, 
    MTO_RED, 
    FOLIO_AFECT, 
    TC_TESO_PVP_PD, 
    TIPO_CAMB,
    FNIMPMOV_CAJA, 
    @CERO
      ROW_NUMBER() OVER (PARTITION BY T071_OBSERVATIONS_ALN, FITRANNO_CAJA ORDER BY FCREFMOV_CAJA) AS row_num
    FROM usrcon.TC_ALNCAJA_CONCIL CON
    INNER JOIN usrcon.OP_DEX_TIPO_CAMBIO DEX
    ON CON.FCREFMOV_CAJA = DEX.MTCN
    WHERE @CERO = 0

  )
  INSERT INTO usrcon.CONCIL_ALNCAJA_OPEDEX (NOM_PAIS_ORIG, NOM_PAIS_DEST, CLAVE_SUC_AGE_MVTO, MTCN, FECHA_TRANSC, MTO_ENVIO,
    MTO_ENVIO_USD, COMISION, NOM_AGEN_MVTO, NOM_SUBS_MTVO, TOTAL_IMPTO_MXP, MTO_RED, 
    FOLIO_AFECT, TC_TESO_PVP_PD, TIPO_CAMB,FNIMPMOV_CAJA)
    
  SELECT NOM_PAIS_ORIG, NOM_PAIS_DEST, CLAVE_SUC_AGE_MVTO, MTCN, FECHA_TRANSC, MTO_ENVIO,
    MTO_ENVIO_USD, COMISION, NOM_AGEN_MVTO, NOM_SUBS_MTVO, TOTAL_IMPTO_MXP, MTO_RED, 
    FOLIO_AFECT, TC_TESO_PVP_PD, TIPO_CAMB, FNIMPMOV_CAJA
  FROM duplicates
  WHERE row_num = 1